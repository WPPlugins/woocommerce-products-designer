
var WPD_EDITOR=(function(b,a){b(document).ready(function(){b(document).on("click",".clipart-img img",function(){var j=b(this).attr("src");var i=b(this).data("price");c(j,i)});b(document).on("click","#wpc-add-img",function(l){l.preventDefault();var i=b(this).attr("data-selector");var j=b(this);var k=wp.media({title:"Add image on the design area",button:{text:"Add image"},multiple:false}).on("select",function(){var m=k.state().get("selection");m.map(function(n){n=n.toJSON();c(n.url)})}).open()});b(".native-uploader #userfile").change(function(){var i=b(this).val().toLowerCase();if(i!=""){b("#userfile_upload_form").ajaxForm({success:d}).submit()}});b("#drop a").click(function(){b(this).parent().find("input").click()});if(b("#userfile_upload_form.custom-uploader").length){var h=b("#userfile_upload_form.custom-uploader .acd-upload-info");b("#userfile_upload_form.custom-uploader").fileupload({dropZone:b("#drop"),url:ajax_object.ajax_url,add:function(l,k){var i=b('<div class="working"><div class="acd-info"></div><div class="acd-progress-bar"><div class="acd-progress"></div></div></div>');i.find(".acd-info").text(k.files[0].name).append("<i>"+e(k.files[0].size)+"</i>");h.html("");k.context=i.appendTo(h);i.find("input").knob();i.find("span").click(function(){if(i.hasClass("working")){j.abort()}i.fadeOut(function(){i.remove()})});var j=k.submit()},progress:function(k,j){var i=parseInt(j.loaded/j.total*100,10);j.context.find(".acd-progress").css("width",i+"%");if(i==100){j.context.removeClass("working")}},fail:function(j,i){i.context.addClass("error")},done:function(k,j){var i=j.files[0].name;d(j.result,false,false,false)}})}b(document).on("drop dragover",function(i){i.preventDefault()});b(".acd-grayscale").change(function(){g(new fabric.Image.filters.Grayscale(),b(this).is(":checked"))});b(".acd-invert").change(function(){g(new fabric.Image.filters.Invert(),b(this).is(":checked"))});b(".acd-sepia").change(function(){g(new fabric.Image.filters.Sepia(),b(this).is(":checked"))});b(".acd-sepia2").change(function(){g(new fabric.Image.filters.Sepia2(),b(this).is(":checked"))});b(".acd-blur").change(function(){if(b(this).is(":checked")){b("#sharpen, #emboss").removeAttr("checked")}g(new fabric.Image.filters.Convolute({matrix:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}),b(this).is(":checked"))});b(".acd-sharpen").change(function(){if(b(this).is(":checked")){b("#blur, #emboss").removeAttr("checked")}g(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}),b(this).is(":checked"))});b(".acd-emboss").change(function(){if(b(this).is(":checked")){b("#sharpen, #blur").removeAttr("checked")}g(new fabric.Image.filters.Convolute({matrix:[1,1,1,1,0.7,-1,-1,-1,-1]}),b(this).is(":checked"))});function g(k,l){var j=a.canvas.getActiveObject();var i=jQuery.inArray(k.type.toLowerCase(),a.arr_filters);console.log(j);if((j!=null)&&(j.type=="image")){if(l){j.filters[i]=k}else{j.filters[i]=false}j.applyFilters(a.canvas.renderAll.bind(a.canvas));a.save_canvas()}}a.is_json=function(i){if(/^[\],:{}\s]*$/.test(i.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return true}else{return false}};function c(i,k){var j=i.split(".").pop();if(typeof k=="undefined"){k=0}if(j=="svg"){fabric.loadSVGFromURL(i,function(m,l){var n=fabric.util.groupSVGElements(m,l);f(n);a.setCustomProperties(n);n.set("price",k);if(a.box_center_x){n.set("left",a.box_center_x);n.set("top",a.box_center_y);a.canvas.add(n).calcOffset().renderAll()}else{a.canvas.add(n);a.centerObject(n);a.canvas.calcOffset().renderAll()}n.setCoords();a.save_canvas()})}else{fabric.Image.fromURL(i,function(l){var m=f(l);a.setCustomProperties(l);l.set("price",k);if(a.box_center_x){a.canvas.add(l.set({left:a.box_center_x-m[0]/2,top:a.box_center_y-m[1]/2,angle:0})).renderAll()}else{a.canvas.add(l.set({left:100,top:100,angle:0}));a.centerObject(l);a.canvas.calcOffset().renderAll()}l.setCoords();a.save_canvas()})}}function f(n){var l=a.canvas.getWidth();var i=a.canvas.getHeight();var k=a.get_img_best_fit_dimensions(n,l,i);var j=l/k[0];var m=i/k[1];if(j>m){n.scaleToWidth(k[0])}else{n.scaleToHeight(k[1])}return k}function d(k,l,m,j){if(a.is_json(k)){var i=b.parseJSON(k);if(i.success){b("#acd-uploaded-img").append(i.message);if(i.img_url){c(i.img_url,0)}}else{alert(i.message)}}else{b("#debug").html(k)}b("#userfile").val("")}function e(i){if(typeof i!=="number"){return""}if(i>=1000000000){return(i/1000000000).toFixed(2)+" GB"}if(i>=1000000){return(i/1000000).toFixed(2)+" MB"}return(i/1000).toFixed(2)+" KB"}});return a}(jQuery,(WPD_EDITOR||{})));
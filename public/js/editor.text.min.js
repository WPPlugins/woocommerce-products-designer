
var WPD_EDITOR=(function(b,a){b(document).ready(function(){b(document).on("click","#wpc-add-text",function(i){i.preventDefault();var h=b("#new-text").val();var g=b("#cb-curved").is(":checked");if(h.length==0){alert(wpd.translated_strings.empty_txt_area_msg)}else{if(!g){c(h,false,false)}else{f(h)}}});function c(g,i,h){var j=e(g);a.canvas.add(j);if(i){j.set("left",i);j.set("top",h)}else{if(a.box_center_x){j.set("left",a.box_center_x);j.set("top",a.box_center_y)}else{a.centerObjectH(j);a.centerObjectV(j)}}a.canvas.renderAll();j.setCoords();b("#new-text").val("");a.save_canvas()}b("#font-family-selector").trigger("change");b("#font-family-selector").css("font-family",b("#font-family-selector").val());b("#font-family-selector").change(function(){var i=a.canvas.getActiveObject();var g=parseInt(b("#font-size-selector").val());var h=b(this).val();b(this).css("font-family",h);if((i!=null)&&(i.type=="i-text")){i.set("fontFamily",h);i.setFontSize(parseInt(g));a.canvas.renderAll()}else{if((i!=null)&&(i.type=="group")){i.forEachObject(function(j){j.set("fontFamily",h);j.setFontSize(parseInt(g));a.canvas.renderAll()})}}});b("#font-size-selector").change(function(){var h=a.canvas.getActiveObject();var g=parseInt(b("#font-size-selector").val());if((h!=null)&&(h.type=="i-text")){h.setFontSize(parseInt(g));a.canvas.renderAll()}else{if((h!=null)&&(h.type=="group")){d(h)}}});b(".txt-align").change(function(){var h=b(this).val();var g=a.canvas.getActiveObject();if((g!=null)&&(g.type=="i-text")){g.set("textAlign",h);a.canvas.renderAll()}else{if((g!=null)&&(g.type=="group")){g.forEachObject(function(i){i.set("textAlign",h);a.canvas.renderAll()})}}});b("#bold-cb").change(function(){var g=a.canvas.getActiveObject();var h=b("#bold-cb").is(":checked");if((g!=null)&&(g.type=="i-text")){if(h){g.set("fontWeight","bold")}else{g.set("fontWeight","normal")}a.canvas.renderAll()}else{if((g!=null)&&(g.type=="group")){g.forEachObject(function(i){if(h){i.set("fontWeight","bold")}else{i.set("fontWeight","normal")}a.canvas.renderAll()})}}});b("#italic-cb").change(function(){var h=a.canvas.getActiveObject();var g=b("#italic-cb").is(":checked");if((h!=null)&&(h.type=="i-text")){if(g){h.set("fontStyle","italic")}else{h.set("fontStyle","normal")}a.canvas.renderAll()}else{if((h!=null)&&(h.type=="group")){h.forEachObject(function(i){if(g){i.set("fontStyle","italic")}else{i.set("fontStyle","normal")}a.canvas.renderAll()})}}});b("#o-thickness-slider").change(function(){var g=a.canvas.getActiveObject();if((g!=null)&&(g.type=="i-text")){if(b(this).val()>0){var h=b("#txt-outline-color-selector").css("background-color");g.set("strokeWidth",parseInt(b(this).val()));g.set("stroke",h)}else{g.set("stroke",false)}a.canvas.renderAll()}else{if((g!=null)&&(g.type=="group")){d(g)}}});b("#cb-curved").change(function(){var g=b("#cb-curved").is(":checked");var h=a.canvas.getActiveObject();if(g){if(h!=null){var j=h.get("left");var i=h.get("top");if(h.type=="i-text"){var k=h.get("text");a.canvas.remove(h);f(k,i,j);a.save_canvas();a.canvas.renderAll();b("#cb-curved").attr("checked","checked")}}}else{if(h!=null){var j=h.get("left");var i=h.get("top");if(h.type=="group"){var k=h.get("originalText");a.canvas.remove(h);c(k,i,j);a.save_canvas();a.canvas.renderAll()}}}});b("#curved-txt-radius-slider, #curved-txt-spacing-slider").change(function(){var g=a.canvas.getActiveObject();if((g!=null)&&(g.type=="group")){d(g)}});b("[id$='opacity-slider']").change(function(){var g=a.canvas.getActiveObject();if(g!=null){g.set("opacity",b(this).val());a.canvas.renderAll();a.save_canvas()}});b(".txt-decoration").change(function(){var h=a.canvas.getActiveObject();var g=b(this).val();if((h!=null)&&(h.type=="i-text")){h.set("textDecoration",g);a.canvas.renderAll()}});function f(y,k,h){var A=y.length;var u;var i=b("#curved-txt-radius-slider").val();var j=b("#curved-txt-spacing-slider").val();if(!i){i=150}if(!j){j=10}var B=0;var o=0;var z=0;var r=a.canvas.getWidth()/2;var p=a.canvas.getHeight()-30;z=(j/2)*(A-1);var q=false;var l=1;if(q){l=-1}var w=[];for(var x=0;x<A;x++){u=y[x];var t=e(u);B=(x*parseInt(j,10))-z;o=B*(Math.PI/180);if(q){B=(-x*parseInt(j,10))+z;o=B*(Math.PI/180)}var v=(r+(-Math.cos(o)*i))*l;var g=(p+(Math.sin(o)*i))*l;t.set("top",v);t.set("left",g);t.setAngle(B);w.push(t)}var m=new fabric.Group(w,{left:150,top:100});if(k!=null){a.canvas.setActiveObject(m)}a.setCustomProperties(m);m.originalText=y;m.radius=i;m.spacing=j;a.canvas.add(m);if(k==null){m.center()}else{m.set("left",h);m.set("top",k)}a.save_canvas();a.canvas.renderAll();m.setCoords()}function e(i){var q=b("#o-thickness-slider").val();var p="normal";var t="";var h="";var k=b("#txt-color-selector").css("background-color");var n=b("#font-family-selector").val();var g=parseInt(b("#font-size-selector").val());var l=b("#opacity-slider").val();var s=b("#txt-outline-color-selector").css("background-color");var j=b("#bold-cb").is(":checked");var m=b("#underline-cb").is(":checked");var o=b("#italic-cb").is(":checked");if(j){p="bold"}if(m){t="underline"}if(o){h="italic"}if(!n){n="Arial"}if(!g){g=30}if(!p){p="normal"}if(!k){k="rgb(198, 196, 196)"}if(!l){l=1}var r=new fabric.IText(i,{left:30,top:70,fontFamily:n,fontSize:g,fontWeight:p,fontStyle:h,textDecoration:t,selectable:true,fill:k,opacity:l,});if(q>0){r.set("stroke",s);r.set("strokeWidth",parseInt(q))}a.setCustomProperties(r);return r}function d(i){var h=i.get("left");var g=i.get("top");a.canvas.remove(i);f(i.originalText,g,h)}b("#new-text").keyup(function(){var h=a.canvas.getActiveObject();var g=b("#new-text").val();if((h!=null)&&(h.type=="i-text")){h.set("text",g);a.save_canvas();a.canvas.renderAll()}else{if((h!=null)&&(h.type=="group")){var j=h.get("left");var i=h.get("top");a.canvas.remove(h);f(g,i,j)}}});b('[id$="color-selector"]').each(function(){var h=b(this).attr("id");var g=b(this).css("background-color");if(!g){g="#0000ff"}if(wpd.palette_type=="custom"){b("#"+h).qtip({content:"<div class='wpc-custom-colors-container' data-id='"+h+"'>"+wpd.palette_tpl+"</div>",position:{corner:{target:"middleRight",tooltip:"leftTop"}},style:{width:200,padding:5,background:"white",color:"black",border:{width:1,radius:1,color:"#08AED6"}},tip:"bottomLeft",show:"click",hide:{when:{event:"unfocus"}}})}else{b("#"+h).ColorPicker({color:g,onShow:function(i){b(i).fadeIn(500);return false},onHide:function(j){b(j).fadeOut(500);var i=a.canvas.getActiveObject();if((i!=null)){a.save_canvas()}return false},onChange:function(i,k,j){a.change_item_color(h,k)}})}})});return a}(jQuery,(WPD_EDITOR||{})));
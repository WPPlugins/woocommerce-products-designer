
var WPD_EDITOR=(function(b,a){var a={};a.canvas={};a.serialized_parts=[];a.final_canvas_parts={};a.selected_part=-1;a.canvasManipulationsPosition=[];a.box_center_x=false;a.box_center_y=false;a.arr_filters=["grayscale","invert","remove-white","sepia","sepia2","brightness","noise","gradient-transparency","pixelate","blur","convolute"];b(document).ready(function(){var c;var e=new Spry.Widget.Accordion("wpc-tools-box-container",{useFixedPanelHeights:false,defaultPanel:-1});new Spry.Widget.Accordion("img-cliparts-accordion",{useFixedPanelHeights:false,defaultPanel:-1});new Spry.Widget.Accordion("my-designs-accordion",{useFixedPanelHeights:false,defaultPanel:-1});b("[data-original-title]").tooltip();d();q();function k(){var B=b("#wpc-editor-container").outerWidth();var z=0;var A=0;if(wpd.canvas_w>B){z=B;A=(z*wpd.canvas_h)/wpd.canvas_w}else{z=wpd.canvas_w;A=wpd.canvas_h}return[z,A]}b(document).on("click","#wpc-parts-bar > li",function(C){var B=b(this).attr("data-url");if(a.selected_part==b(this).index()){return}else{h(b(this).index());b("#wpc-parts-bar > li").removeClass("active");b(this).addClass("active");if(a.selected_part>=0){a.save_canvas();a.canvas.clear()}a.selected_part=b(this).index();if(B){var A="url('"+B+"') no-repeat center center";b("#wpc-editor-container").css("background",A)}else{b("#wpc-editor-container").css("background","none")}}var z=b(this).attr("data-id");if(typeof a.serialized_parts[z]=="undefined"){a.serialized_parts[z]=[];a.canvasManipulationsPosition[z]=-1}if(a.serialized_parts[z][a.canvasManipulationsPosition[z]]){b.blockUI({message:wpd.translated_strings.loading_msg});a.canvas.loadFromJSON(a.serialized_parts[z][a.canvasManipulationsPosition[z]],function(){g();b.unblockUI()})}a.refresh_undo_redo_status()});function l(){a.canvas.forEachObject(function(z){if(z.type==="image"&&z.filters.length){z.applyFilters(function(){z.canvas.renderAll()})}})}if(typeof to_load!=="undefined"){setTimeout(function(){m(to_load)},500)}function d(){var z=k();a.canvas=new fabric.Canvas("wpc-editor",{width:z[0],height:z[1]});a.canvas.backgroundImageStretch=false;a.canvas.renderAll();w()}function w(){a.canvas.on("object:selected",function(I){b("#cb-curved").removeAttr("checked");if(I.target){var z=I.target.type;var D=["rect","circle","triangle","polygon","path"];if(z=="i-text"){e.openPanel("text-panel");b("#font-family-selector").val(I.target.get("fontFamily"));b("#font-size-selector").val(I.target.get("fontSize"));b("#txt-color-selector").css("background-color",I.target.get("fill"));b("#txt-bg-color-selector").css("background-color",I.target.get("backgroundColor"));b("#new-text").val(I.target.get("text"));b(".txt-align[value='"+I.target.get("textAlign")+"']").attr("checked","checked");b(".txt-decoration[value='"+I.target.get("textDecoration")+"']").attr("checked","checked");var H=I.target.get("fontWeight");if(H=="bold"){b("#bold-cb").attr("checked","checked")}else{b("#bold-cb").removeAttr("checked")}var C=I.target.get("fontStyle");if(C=="italic"){b("#italic-cb").attr("checked","checked")}else{b("#italic-cb").removeAttr("checked")}if(I.target.get("stroke")!=false&&I.target.getStroke()!=null){b("#txt-outline-color-selector").css("background-color",I.target.get("stroke"));b("#o-thickness-slider").val(I.target.get("strokeWidth"))}else{b("#o-thickness-slider").val(0)}var E=I.target.opacity;b("#opacity-slider").val(E)}else{if(z=="group"){if(I.target.get("originalText")){b("#cb-curved").attr("checked","checked");e.openPanel("text-panel");b("#font-family-selector").val(I.target.item(0).get("fontFamily")).trigger("change");b("#font-size-selector").val(I.target.item(0).get("fontSize"));b("#txt-color-selector").css("background-color",I.target.item(0).get("fill"));b("#txt-bg-color-selector").css("background-color",I.target.item(0).get("backgroundColor"));b("#new-text").val(I.target.get("originalText"));b("#curved-txt-radius-slider").val(I.target.get("radius"));b("#curved-txt-spacing-slider").val(I.target.get("spacing"));b(".txt-align[value='"+I.target.item(0).get("textAlign")+"']").attr("checked","checked");b(".txt-decoration[value='"+I.target.item(0).get("textDecoration")+"']").attr("checked","checked");var H=I.target.item(0).get("fontWeight");if(H=="bold"){b("#bold-cb").attr("checked","checked")}else{b("#bold-cb").removeAttr("checked")}var C=I.target.item(0).get("fontStyle");if(C=="italic"){b("#italic-cb").attr("checked","checked")}else{b("#italic-cb").removeAttr("checked")}if(I.target.item(0).get("stroke")!=false&&I.target.item(0).getStroke()!=null){b("#txt-outline-color-selector").css("background-color",I.target.item(0).get("stroke"));b("#o-thickness-slider").val(I.target.item(0).get("strokeWidth"))}else{b("#o-thickness-slider").val(0)}var E=I.target.item(0).opacity;b("#opacity-slider").val(E)}}else{if(jQuery.inArray(z,D)>=0){var G=I.target.opacity;b("#shape-opacity-slider").val(G);b("#shape-bg-color-selector").css("background-color",I.target.get("fill"));b("#shape-outline-color-selector").css("background-color",I.target.get("stroke"));b("#shape-thickness-slider").val(I.target.get("strokeWidth"));e.openPanel("shapes-panel")}else{if(z=="image"){var F=I.target._originalElement.attributes[0].nodeValue;var B=b("#img-cliparts-accordion img[src='"+F+"']").length;if(B){e.openPanel("cliparts-panel")}else{e.openPanel("uploads-panel")}var A=I.target.filters;b("#img-effects input:checkbox").removeAttr("checked");b.each(A,function(M,O){if(O){var N=O.type;var L=O.matrix;var K=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];var J=[0,-1,0,-1,5,-1,0,-1,0];var P=[1,1,1,1,0.7,-1,-1,-1,-1];if(N=="Grayscale"){b(".acd-grayscale").attr("checked","checked")}else{if(N=="Invert"){b(".acd-invert").attr("checked","checked")}else{if(N=="Sepia"){b(".acd-sepia").attr("checked","checked")}else{if(N=="Sepia2"){b(".acd-sepia2").attr("checked","checked")}else{if(N=="Convolute"){if((b(L).not(K).length==0&&b(K).not(L).length==0)){b(".acd-blur").attr("checked","checked")}else{if((b(L).not(J).length==0&&b(J).not(L).length==0)){b(".acd-sharpen").attr("checked","checked")}else{if((b(L).not(P).length==0&&b(P).not(L).length==0)){b(".acd-emboss").attr("checked","checked")}}}}else{console.log(N,L)}}}}}}})}}}}if(I.target.get("lockMovementX")){b("#lock-mvt-x").attr("checked","checked")}else{b("#lock-mvt-x").removeAttr("checked")}if(I.target.get("lockMovementY")){b("#lock-mvt-y").attr("checked","checked")}else{b("#lock-mvt-y").removeAttr("checked")}if(I.target.get("lockScalingX")){b("#lock-scl-x").attr("checked","checked")}else{b("#lock-scl-x").removeAttr("checked")}if(I.target.get("lockScalingY")){b("#lock-scl-y").attr("checked","checked")}else{b("#lock-scl-y").removeAttr("checked")}if(I.target.get("lockDeletion")){b("#lock-Deletion").attr("checked","checked")}else{b("#lock-Deletion").removeAttr("checked")}}});a.canvas.on("object:added",function(A){if(A.target){a.canvas.calcOffset();a.canvas.renderAll();A.target.setCoords();var z=A.target.type;if(z=="i-text"){j()}a.canvas.calcOffset()}});a.canvas.on("object:modified",function(z){a.canvas.calcOffset();a.canvas.renderAll();z.target.setCoords();a.save_canvas()})}a.setCustomProperties=function(z){z.toObject=(function(A){return function(){return fabric.util.object.extend(A.call(this),{lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,lockScalingX:this.lockScalingX,lockScalingY:this.lockScalingY,lockDeletion:this.lockDeletion,price:this.price,originalText:this.originalText,radius:this.radius,spacing:this.spacing})}})(z.toObject)};a.save_canvas=function(){var z=b("#wpc-parts-bar > li:eq("+a.selected_part+")").attr("data-id");if(typeof a.serialized_parts[z]=="undefined"){a.serialized_parts[z]=["{}"]}var B;for(B=a.canvasManipulationsPosition[z];B<=a.serialized_parts[z].length-2;B++){a.serialized_parts[z].pop()}a.canvasManipulationsPosition[z]++;var A=JSON.stringify(a.canvas.toJSON(["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","price","lockDeletion","originalText","radius","spacing"]));a.serialized_parts[z].push(A);r();a.refresh_undo_redo_status()};a.centerObjectH=function(z){var B=z.getWidth();var A=(parseFloat(wpd.canvas_w)-B)/2;z.set("left",A)};a.centerObjectV=function(z){var A=z.getHeight();var B=(parseFloat(wpd.canvas_h)-A)/2;z.set("top",B)};a.centerObject=function(z){a.centerObjectV(z);a.centerObjectH(z)};a.change_item_color=function(B,A){b("#"+B).css("background-color","#"+A);var z=a.canvas.getActiveObject();if((z!=null)&&(z.type!="group")){v(B,z,A)}else{if((z!=null)&&(z.type=="group")){z.forEachObject(function(C){v(B,C,A)})}}};function v(B,z,A){if((B=="txt-color-selector")||(B=="shape-bg-color-selector")||B=="clipart-bg-color-selector"){z.set("fill","#"+A)}else{if(B=="txt-bg-color-selector"){z.set("backgroundColor","#"+A)}else{if(B=="txt-outline-color-selector"||B=="shape-outline-color-selector"){z.set("stroke","#"+A)}else{console.log("unknow color selector :#"+B)}}}a.canvas.renderAll()}a.refresh_undo_redo_status=function(){var z=b("#wpc-parts-bar > li:eq("+a.selected_part+")").attr("data-id");if((a.serialized_parts[z].length==1)||(a.canvasManipulationsPosition[z]==0)){b("#undo-btn").addClass("disabled")}else{b("#undo-btn").removeClass("disabled")}if((a.serialized_parts[z].length>0)&&(a.canvasManipulationsPosition[z]<a.serialized_parts[z].length-1)){b("#redo-btn").removeClass("disabled")}else{b("#redo-btn").addClass("disabled")}};function r(){var A=b("#wpc-parts-bar > li").length;var z={};b.each(b("#wpc-parts-bar > li"),function(D,C){var B=b(this).attr("data-id");if((a.serialized_parts[B])){z[B]={json:a.serialized_parts[B][a.canvasManipulationsPosition[B]]}}if(b(this).index()==A-1){var E=wpd.global_variation_id;b.post(ajax_object.ajax_url,{action:"get_design_price",variation_id:E,serialized_parts:z},function(G){if(a.is_json(G)){var F=JSON.parse(G);b("#total_order").text(F.price);b("#wpd-qty").attr("uprice",F.price);b("#wpd-qty").trigger("change")}else{b("#debug").html(G)}})}})}function m(B){var z=b("#wpc-parts-bar > li").first().data("id");if(typeof B=="object"){var A=false;b.each(B,function(C,D){b.each(D,function(G,E){if(G=="json"){a.serialized_parts[C]=[];a.canvasManipulationsPosition[C]=0;var F=E;a.serialized_parts[C].push(F);if(C==z){A=true;a.selected_part=0;a.canvas.loadFromJSON(F,function(){a.canvas.renderAll.bind(a.canvas);g()});a.canvas.calcOffset();x();if(F.indexOf('{"type":"text"')>-1){o()}}}})});if(!A){b("#wpc-parts-bar > li").first().click()}else{h(0)}}}function x(){var A=b("#wpc-parts-bar > li").first().attr("data-url");var z="url('"+A+"') no-repeat center center";b("#wpc-editor-container").css("background",z)}function q(){if(typeof to_load=="undefined"){b("#wpc-parts-bar > li").each(function(A){var z=b(this).attr("data-id");a.serialized_parts[z]=[];a.canvasManipulationsPosition[z]=-1;var B=b("#wpc-parts-bar > li").length;if(A==B-1){p(wpd.output_loop_delay,t,function(){b("#wpc-parts-bar > li").first().click();a.canvas.renderAll();g();b.unblockUI()})}})}}function t(z){b("#wpc-parts-bar > li:eq("+z+")").click()}function p(z,C,B){b.blockUI({message:wpd.translated_strings.loading_msg});var D=b("#wpc-parts-bar > li").length;var A=0;var E=setInterval(function(){if(b.isFunction(C)){C(A)}if(A==D-1){window.clearInterval(E);if(b.isFunction(B)){setTimeout(function(){B()},z)}else{b.unblockUI()}}else{A++}},z)}function h(D,G,B){var z=b("#wpc-parts-bar > li:eq("+D+")");var A=z.attr("data-ovni");if(typeof B=="undefined"){B=false}var H=z.data("bg");if(H==""){H=null}var F=z.data("ov");if(F==""){F=null}var E=new Image();E.onload=function(){var I=a.get_img_best_fit_dimensions(E,wpd.canvas_w,wpd.canvas_h);a.canvas.setBackgroundImage(E.src,a.canvas.renderAll.bind(a.canvas),{left:wpd.canvas_w/2,top:wpd.canvas_h/2,originX:"center",originY:"center",width:I[0],height:I[1]})};if(H!=null){E.src=H}else{a.canvas.backgroundImage=null}if(A=="-1"&&B){a.canvas.overlayImage=null;a.canvas.renderAll.bind(a.canvas)}else{var C=new Image();C.onload=function(){var I=a.get_img_best_fit_dimensions(C,wpd.canvas_w,wpd.canvas_h);a.canvas.setOverlayImage(C.src,a.canvas.renderAll.bind(a.canvas),{left:wpd.canvas_w/2,top:wpd.canvas_h/2,originX:"center",originY:"center",width:I[0],height:I[1]})};if(F!=null){C.src=F}}if(b.isFunction(G)){setTimeout(function(){G(D)},200)}}a.get_img_best_fit_dimensions=function(A,E,B){var z=A.width;var D=A.height;if(z<E&&D<B){return[z,D]}var C=z/D;z=E;D=E/C;if(D>B){D=B;z=B*C}return[z,D]};b(document).on("click",".wpc-custom-colors-container span",function(A){var B=b(this).parent().data("id");var z=b(this).data("color");a.change_item_color(B,z)});function o(){var z=["active","angle","backgroundColor","clipTo","currentHeight","currentWidth","fill","currentWidth","flipX","flipY","fontFamily","fontSize","fontStyle","fontWeight","height","left","lineHeight","originX","originY","scaleX","scaleY","shadow","text","textAlign","textBackgroundColor","textDecoration","top","width","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockUniScaling"];setTimeout(function(){var A=a.canvas.getObjects().map(function(B){return B});b.each(A,function(D,C){if(C.type=="text"){var B=new fabric.IText("");b.each(z,function(E,F){B.set(F,C.get(F))});a.canvas.remove(C);a.canvas.add(B)}});a.canvas.renderAll.bind(a.canvas)},3600)}function j(){b("#new-text").val("");b(".txt-align").removeAttr("checked");b(".txt-decoration").removeAttr("checked");b("#bold-cb").removeAttr("checked");b("#italic-cb").removeAttr("checked");b("#font-family-selector").val(b("#font-family-selector option:first").val()).trigger("change");b("#o-thickness-slider").val(b("#o-thickness-slider option:first").val());b("#opacity-slider").val(1)}b(document).on("touchstart click","#preview-btn",function(){b("#wpd-modal .modal-body").html("");a.save_canvas();p(wpd.output_loop_delay,i,function(){b("#wpc-parts-bar > li").first().click();b("#wpd-modal").modal("show");b.unblockUI()})});b(document).on("click","#download-btn",function(){b("#debug").html("");p(wpd.output_loop_delay,n,function(){if(jQuery.isEmptyObject(a.final_canvas_parts)){b("#debug").html("<div class='wpc-failure'>"+wpd.translated_strings.empty_object_msg+"</div>");b.unblockUI()}else{var A=wpd.global_variation_id;var z=new FormData();z.append("action","generate_downloadable_file");z.append("variation_id",A);z=u(z);b.ajax({type:"POST",url:ajax_object.ajax_url,data:z,processData:false,contentType:false}).done(function(C){b.unblockUI();if(a.is_json(C)){var B=JSON.parse(C);if(b("#wpc-parts-bar > li").length>1){b("#wpc-parts-bar > li").first().click()}else{f()}b("#debug").html(B.message)}else{b("#debug").html(C)}})}})});b(document).on("touchstart click","#save-btn",function(){p(wpd.output_loop_delay,n,function(){if(jQuery.isEmptyObject(a.final_canvas_parts)){b("#debug").html("<div class='wpc-failure'>"+wpd.translated_strings.empty_object_msg+"</div>");b.unblockUI()}else{var C=b("#wpd-qty").val();var z=b("#save-btn").data("index");var B=wpd.global_variation_id;var A=new FormData();A.append("action","save_custom_design_for_later");A.append("variation_id",B);A.append("design_index",z);A=u(A);b.ajax({type:"POST",url:ajax_object.ajax_url,data:A,processData:false,contentType:false}).done(function(E){b.unblockUI();if(a.is_json(E)){var D=JSON.parse(E);b("#wpc-parts-bar > li").first().click();if(!E.is_logged){b(location).attr("href",D.url)}else{if(E.success){b(location).attr("href",D.url)}}}else{b("#debug").html(E)}})}})});b(".wpd-delete-design").click(function(){var z=b(this).data("index");var B=wpd.global_variation_id;var A=b(this);b.get(ajax_object.ajax_url,{action:"delete_saved_design",design_index:z,variation_id:B},function(C){if(C.success){b(location).attr("href",C.url)}else{alert(C.message)}},"json")});b(document).on("click","#wpc-qty-container .plus, #wpc-qty-container .minus",function(){var A=b("#wpd-qty"),B=parseFloat(A.val()),z=parseFloat(A.attr("max")),C=parseFloat(A.attr("min")),D=A.attr("step");if(!B||B===""||B==="NaN"){B=0}if(z===""||z==="NaN"){z=""}if(C===""||C==="NaN"){C=0}if(D==="any"||D===""||D===undefined||parseFloat(D)==="NaN"){D=1}if(b(this).is(".plus")){if(z&&(z==B||B>z)){A.val(z)}else{A.val(B+parseFloat(D))}}else{if(C&&(C==B||B<C)){A.val(C)}else{if(B>0){A.val(B-parseFloat(D))}}}A.trigger("change")});b(document).on("change","#wpd-qty",function(){var C=b(this).val();var A=b(this).attr("uprice");var z=b("#wpd-qty").attr("opt_price");if(!b.isNumeric(C)){b(this).val(1);b("#total_order").html(A);return}if(b.isNumeric(z)){A=parseFloat(A)+parseFloat(z)}var B=A*C;b("#total_order").html(B.toFixed(2))});b(document).on("touchstart click","#add-to-cart-btn",function(){b("#debug").html("");a.save_canvas();p(wpd.output_loop_delay,n,function(){if(jQuery.isEmptyObject(a.final_canvas_parts)){b("#debug").html("<div class='wpc-failure'>"+wpd.translated_strings.empty_object_msg+"</div>");b.unblockUI()}else{var D=b("#wpd-qty").val();var C=wpd.global_variation_id;var z=wpd.query_vars.edit;if(typeof z=="undefined"){z=""}var B=new FormData();B.append("variation_id",C);B.append("action","add_custom_design_to_cart");B.append("cart_item_key",z);B.append("final_canvas_parts",a.final_canvas_parts);B.append("quantity",D);if(b(".ninja-forms-form").length>0){var A=JSON.stringify(get_design_options());B.append("wpd-design-opt",A)}B=u(B);b.ajax({type:"POST",url:ajax_object.ajax_url,data:B,processData:false,contentType:false}).done(function(F){if(a.is_json(F)){var E=JSON.parse(F);if(b("#wpc-parts-bar > li").length>1){b("#wpc-parts-bar > li").first().click()}else{f()}if(wpd.redirect_after==1){b(location).attr("href",E.url)}else{b("#debug").html(E.message);b.unblockUI()}}else{b("#debug").html(F);b.unblockUI()}})}})});b("#lock-mvt-x, #lock-mvt-y, #lock-scl-x, #lock-scl-y, #lock-Deletion").change(function(C){var B=b(this).data("property");var z=a.canvas.getActiveObject();var A=a.canvas.getActiveGroup();if(z!=null){if(b(this).is(":checked")){z[B]=true}else{z[B]=false}a.save_canvas()}else{if(A!=null){if(b(this).is(":checked")){A[B]=true}else{A[B]=false}a.save_canvas()}}});b(".post-type-wpc-template #publish").click(function(z){z.preventDefault();p(wpd.output_loop_delay,n,function(){if(jQuery.isEmptyObject(a.final_canvas_parts)){alert(wpd.translated_strings.empty_object_msg);b.unblockUI()}else{var A=new FormData();A.append("action","save_canvas_to_session");A=u(A);b.ajax({type:"POST",url:ajax_object.ajax_url,data:A,processData:false,contentType:false}).done(function(B){b("#post").submit()})}})});function n(z){i(z,false)}function i(C,B){a.selected_part=C;B=typeof B!=="undefined"?B:true;var z=b("#wpc-parts-bar > li:eq("+C+")").attr("data-id");var A=b("#wpc-parts-bar > li:eq("+C+")").attr("data-url");a.canvas.clear();if(typeof a.serialized_parts[z]=="undefined"){a.serialized_parts[z]=["{}"]}a.canvas.loadFromJSON(a.serialized_parts[z][a.canvasManipulationsPosition[z]],function(){l();h(a.selected_part,function(){var K=wpd.output_w/a.canvas.getWidth();if(B){K=1}var J=a.canvas.toDataURL({format:"png",multiplier:K,quality:1});var E=y(J);if(B){var D="";if(wpd.watermark){var F=new FormData();F.append("action","get_watermarked_preview");F.append("watermark",wpd.watermark);F.append("image",E);b.ajax({type:"POST",url:ajax_object.ajax_url,data:F,processData:false,contentType:false}).done(function(M){if(a.is_json(M)){var L=JSON.parse(M);if(A){D="<div style='background-image:url("+A+");'><img src='"+L.url+"'></div>"}else{D="<div><img src='"+L.url+"'></div>"}b("#wpd-modal .modal-body").append(D)}else{b("#debug").html(M)}})}else{if(A){D="<div style='background-image:url("+A+");'><img src='"+J+"'></div>"}else{D="<div><img src='"+J+"'></div>"}b("#wpd-modal .modal-body").append(D)}}else{var I=b.parseJSON(a.serialized_parts[z][a.canvasManipulationsPosition[z]]);var H=[];if(wpd.print_layers){var G=I.objects;b.each(G,function(N,M){a.canvas.clear();var L=I;L.objects=[M];var O=JSON.stringify(L);a.canvas.loadFromJSON(O,function(){l();a.canvas.renderAll.bind(a.canvas);h(a.selected_part,"",true);var R=wpd.output_w/a.canvas.getWidth();var P=a.canvas.toDataURL({format:"png",multiplier:R,quality:1});var Q=y(P);H.push(Q);if(N==G.length-1){a.canvas.loadFromJSON(a.serialized_parts[z][a.canvasManipulationsPosition[z]]);l()}})})}a.final_canvas_parts[z]={json:a.serialized_parts[z][a.canvasManipulationsPosition[z]],image:E,original_part_img:A,layers:H}}h(a.selected_part)},true)})}function y(A){var E;if(A.split(",")[0].indexOf("base64")>=0){E=atob(A.split(",")[1])}else{E=unescape(A.split(",")[1])}var z=A.split(",")[0].split(":")[1].split(";")[0];var C=new Uint8Array(E.length);for(var D=0;D<E.length;D++){C[D]=E.charCodeAt(D)}var B=new Blob([C],{type:z});return B}function u(z){b.each(a.final_canvas_parts,function(B,A){b.each(A,function(D,C){if(D=="image"){z.append(B+"["+D+"]",C)}else{if(D=="layers"){b.each(C,function(F,E){z.append("layers["+B+"][]",E)})}else{z.append("final_canvas_parts["+B+"]["+D+"]",C)}}})});return z}function f(){var z=b("#wpc-parts-bar > li:eq(0)").attr("data-id");a.canvas.clear();a.canvas.loadFromJSON(a.serialized_parts[z][a.canvasManipulationsPosition[z]],function(){a.canvas.renderAll.bind(a.canvas);g()})}function g(){var A=k();var z=A[0]/wpd.canvas_w;if(z!=1){a.canvas.setWidth(A[0]);a.canvas.setHeight(A[1]);a.canvas.setZoom(z);a.canvas.calcOffset();a.canvas.renderAll()}l()}b(window).resize(function(){clearTimeout(c);c=setTimeout(s,500)});function s(){b(".canvas-container").hide();g();b(".canvas-container").show()}b(document).keydown(function(B){var z=a.canvas.getActiveObject();var A=a.canvas.getActiveGroup();if(B.which==46){b("#delete_btn").click()}else{if(B.which==37){if(A!=null&&!A.get("lockMovementX")){A.set("left",A.left-1);a.canvas.renderAll();a.save_canvas()}else{if((z!=null)&&!z.get("lockMovementX")){z.set("left",z.left-1);a.canvas.renderAll();a.save_canvas()}}}else{if(B.which==39){if(A!=null&&!A.get("lockMovementX")){A.set("left",A.left+1);a.canvas.renderAll();a.save_canvas()}else{if((z!=null)&&!z.get("lockMovementX")){z.set("left",z.left+1);a.canvas.renderAll();a.save_canvas()}}}else{if(B.which==38){if(A!=null&&!A.get("lockMovementY")){B.preventDefault();A.set("top",A.top-1);a.canvas.renderAll();a.save_canvas()}else{if((z!=null)&&!z.get("lockMovementY")){B.preventDefault();z.set("top",z.top-1);a.canvas.renderAll();a.save_canvas()}}}else{if(B.which==40){if(A!=null&&!A.get("lockMovementY")){B.preventDefault();A.set("top",A.top+1);a.canvas.renderAll();a.save_canvas()}else{if((z!=null)&&!z.get("lockMovementY")){B.preventDefault();z.set("top",z.top+1);a.canvas.renderAll();a.save_canvas()}}}else{if(B.keyCode==67&&B.ctrlKey){b("#copy_paste_btn").click()}else{if(B.keyCode==90&&B.ctrlKey){b("#undo-btn").click()}else{if(B.keyCode==89&&B.ctrlKey){b("#redo-btn").click()}}}}}}}}})});return a}(jQuery,WPD_EDITOR));